---
- name: Check if ruby-install is already installed
  stat:
    path: /usr/local/share/doc/ruby-install-{{ ruby_install_version }}
  register: ruby_install_path

- name: Download ruby-install package
  get_url:
    url: https://github.com/postmodern/ruby-install/archive/v{{ ruby_install_version }}.tar.gz
    dest: /tmp/ruby-install-{{ ruby_install_version }}.tar.gz
  when: ruby_install_path.stat.exists == false

- name: Unarchive ruby-install package
  unarchive:
    src: /tmp/ruby-install-{{ ruby_install_version }}.tar.gz
    dest: /tmp
    creates: /tmp/ruby-install-{{ ruby_install_version }}/Makefile
    remote_src: no
  when: ruby_install_path.stat.exists == false

- name: Run ruby-install install target
  command: make install
  become: yes
    chdir: /tmp/ruby-install-{{ ruby_install_version }}
  when: ruby_install_path.stat.exists == false
